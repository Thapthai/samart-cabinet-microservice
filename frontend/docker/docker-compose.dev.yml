# ================================
# Frontend (Next.js) - Development — Smart Cabinet CU
# ================================
# รันแบบ watch โค้ดจาก host: docker compose -f docker/docker-compose.dev.yml up
# ตัวแปร env ใช้จาก .env หรือ .env.local (ตรงกับ .env.example)

services:
  frontend:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      target: deps
    image: frontend-smart-cabinet:dev
    container_name: smart-cabinet-frontend-dev
    restart: unless-stopped
    ports:
      - "3100:3100"
    environment:
      - NODE_ENV=development
      - PORT=3100
      - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL:-http://localhost:3000/smart-cabinet-cu/api/v1}
      - NEXT_PUBLIC_BASE_PATH=${NEXT_PUBLIC_BASE_PATH:-/smart-cabinet-cu}
      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET:-fKwpUMTYNf8bJZ8hJqDwy6KeXfJgkBce9H9gm48VzvU=}
      - NEXTAUTH_URL=${NEXTAUTH_URL:-http://localhost:3100/smart-cabinet-cu}
    volumes:
      - ../src:/app/src
      - ../public:/app/public
      - ../.next:/app/.next
      - ../tsconfig.json:/app/tsconfig.json
      - ../next.config.js:/app/next.config.js
    command: npm run dev
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3100/smart-cabinet-cu"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s

networks:
  default:
    name: frontend-network
